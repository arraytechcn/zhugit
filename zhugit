#!/bin/bash

# ZhuGit - æœ±æ°Gitæ“ä½œå·¥å…·
# ä½¿ç”¨æ–¹æ³•: zhugit [å‘½ä»¤] [å‚æ•°]

case "$1" in
    "init")
        echo "ğŸš€ åˆå§‹åŒ–Gitä»“åº“..."
        git init
        echo "âœ… Gitä»“åº“åˆå§‹åŒ–å®Œæˆï¼"
        echo "ğŸ’¡ æ¥ä¸‹æ¥å¯ä»¥ï¼š"
        echo "   zhugit add [æ–‡ä»¶]     - æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº"
        echo "   zhugit commit [ä¿¡æ¯]  - æäº¤æ›´æ”¹"
        echo "   zhugit status        - æŸ¥çœ‹çŠ¶æ€"
        ;;
    "new-project"|"new")
        if [ -z "$2" ]; then
            echo "âŒ è¯·æŒ‡å®šé¡¹ç›®åç§°"
            echo "ğŸ’¡ ä½¿ç”¨æ–¹æ³•: zhugit new-project <é¡¹ç›®åç§°>"
        else
            echo "ğŸš€ åˆ›å»ºæ–°é¡¹ç›®: $2"
            mkdir "$2"
            cd "$2"
            git init
            echo "# $2" > README.md
            git add .
            git commit -m "åˆå§‹æäº¤: $2"
            echo "âœ… æ–°é¡¹ç›® '$2' åˆ›å»ºå®Œæˆï¼"
            echo "ğŸ“ é¡¹ç›®ä½ç½®: $(pwd)"
            echo "ğŸ’¡ æ¥ä¸‹æ¥å¯ä»¥ï¼š"
            echo "   zhugit status        - æŸ¥çœ‹çŠ¶æ€"
            echo "   zhugit log          - æŸ¥çœ‹å†å²"
        fi
        ;;
    "connect-github"|"connect")
        if [ -z "$2" ]; then
            echo "âŒ è¯·æŒ‡å®šGitHubä»“åº“åœ°å€"
            echo "ğŸ’¡ ä½¿ç”¨æ–¹æ³•: zhugit connect-github <GitHubä»“åº“URL>"
            echo "ğŸ“‹ ç¤ºä¾‹: zhugit connect-github https://github.com/username/repo.git"
            echo ""
            echo "ğŸ¯ å®Œæ•´æµç¨‹ï¼š"
            echo "   1ï¸âƒ£  zhugit quick-setup é¡¹ç›®åç§°"
            echo "   2ï¸âƒ£  å» https://github.com/new åˆ›å»ºä»“åº“"
            echo "   3ï¸âƒ£  zhugit connect-github https://github.com/ç”¨æˆ·å/ä»“åº“å.git"
        else
            echo "ğŸ”— è¿æ¥åˆ°GitHubä»“åº“: $2"
            echo "ğŸ“‹ æ­¥éª¤1: æ£€æŸ¥å¹¶æ·»åŠ è¿œç¨‹ä»“åº“..."
            if git remote get-url origin >/dev/null 2>&1; then
                echo "âš ï¸  è¿œç¨‹ä»“åº“å·²å­˜åœ¨ï¼Œå°†æ›´æ–°URL"
                git remote set-url origin "$2"
            else
                git remote add origin "$2"
            fi
            
            # æ£€æŸ¥å½“å‰åˆ†æ”¯åç§°
            current_branch=$(git branch --show-current)
            if [ -z "$current_branch" ]; then
                current_branch="main"
                echo "ğŸ“‹ æ­¥éª¤2: åˆ›å»ºmainåˆ†æ”¯..."
                git checkout -b main
            fi
            
            echo "ğŸ“‹ æ­¥éª¤3: æ¨é€ä»£ç åˆ°GitHub..."
            echo "ğŸ“¡ æ¨é€åˆ†æ”¯: $current_branch"
            git push -u origin "$current_branch"
            echo "âœ… GitHubè¿æ¥å®Œæˆï¼"
            echo "ğŸ“¡ è¿œç¨‹ä»“åº“: $2"
            echo ""
            echo "ğŸ‰ é¡¹ç›®å·²æˆåŠŸä¸Šä¼ åˆ°GitHubï¼"
            echo "ğŸŒ æŸ¥çœ‹é¡¹ç›®: $2"
        fi
        ;;
    "quick-setup"|"setup")
        if [ -z "$2" ]; then
            echo "âŒ è¯·æŒ‡å®šé¡¹ç›®åç§°"
            echo "ğŸ’¡ ä½¿ç”¨æ–¹æ³•: zhugit quick-setup <é¡¹ç›®åç§°>"
        else
            echo "ğŸš€ å¿«é€Ÿè®¾ç½®é¡¹ç›®: $2"
            echo "ğŸ“‹ æ­¥éª¤1: åˆ›å»ºé¡¹ç›®ç›®å½•..."
            if [ -d "$2" ]; then
                echo "âš ï¸  ç›®å½•å·²å­˜åœ¨ï¼Œå°†ä½¿ç”¨ç°æœ‰ç›®å½•"
            else
                mkdir "$2"
            fi
            cd "$2"
            echo "ğŸ“‹ æ­¥éª¤2: åˆå§‹åŒ–Gitä»“åº“..."
            if [ -d ".git" ]; then
                echo "âš ï¸  Gitä»“åº“å·²å­˜åœ¨ï¼Œå°†é‡æ–°åˆå§‹åŒ–"
                rm -rf .git
            fi
            git init
            echo "ğŸ“‹ æ­¥éª¤3: åˆ›å»ºREADME.mdæ–‡ä»¶..."
            echo "# $2" > README.md
            echo "ğŸ“‹ æ­¥éª¤4: æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº..."
            git add .
            echo "ğŸ“‹ æ­¥éª¤5: æäº¤åˆå§‹ç‰ˆæœ¬..."
            git commit -m "åˆå§‹æäº¤: $2"
            echo "âœ… é¡¹ç›® '$2' è®¾ç½®å®Œæˆï¼"
            echo "ğŸ“ é¡¹ç›®ä½ç½®: $(pwd)"
            echo ""
            echo "ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œï¼š"
            echo "   1ï¸âƒ£  åˆ›å»ºGitHubä»“åº“: å» https://github.com/new åˆ›å»ºæ–°ä»“åº“"
            echo "   2ï¸âƒ£  è¿æ¥GitHub: zhugit connect-github <GitHubä»“åº“URL>"
            echo "   3ï¸âƒ£  æŸ¥çœ‹çŠ¶æ€: zhugit status"
            echo ""
            echo "ğŸ’¡ å®Œæ•´ç¤ºä¾‹ï¼š"
            echo "   zhugit connect-github https://github.com/arraytechcn/$2.git"
        fi
        ;;
    "add")
        if [ -z "$2" ]; then
            echo "ğŸ“ æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº..."
            git add .
        else
            echo "ğŸ“ æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº: $2"
            git add "$2"
        fi
        echo "âœ… æ–‡ä»¶å·²æ·»åŠ åˆ°æš‚å­˜åŒº"
        ;;
    "checkout"|"co")
        echo "ğŸ“¥ æ£€å‡ºé¡¹ç›®..."
        git checkout "$2"
        ;;
    "update"|"up")
        echo "ğŸ”„ æ›´æ–°é¡¹ç›®..."
        git pull local main
        ;;
    "commit"|"ci")
        echo "ğŸ’¾ æäº¤æ›´æ”¹..."
        git add .
        git commit -m "$2"
        git push local main
        echo "âœ… æäº¤å®Œæˆï¼"
        ;;
    "status"|"st")
        echo "ğŸ“Š é¡¹ç›®çŠ¶æ€:"
        git status --short
        ;;
    "log"|"history")
        echo "ğŸ“ˆ æäº¤å†å²:"
        git log --oneline -10
        ;;
    "revert")
        echo "â†©ï¸ æ¢å¤æ›´æ”¹..."
        git checkout -- "$2"
        ;;
    "rollback"|"rb")
        if [ -z "$2" ]; then
            echo "âŒ è¯·æŒ‡å®šè¦å›æ»šåˆ°çš„æäº¤ID"
            echo "ğŸ’¡ ä½¿ç”¨æ–¹æ³•: zhugit rollback <æäº¤ID>"
            echo "ğŸ“‹ æŸ¥çœ‹å¯ç”¨æäº¤: zhugit log"
        else
            echo "ğŸ”„ å›æ»šåˆ°æäº¤: $2"
            echo "âš ï¸  æ³¨æ„ï¼šè¿™å°†åˆ é™¤åç»­çš„æäº¤å†å²"
            echo "ğŸ’¡ å¦‚éœ€ä¿ç•™å†å²ï¼Œè¯·ä½¿ç”¨: zhugit rollback-to <æäº¤ID>"
            git reset --hard "$2"
            echo "âœ… å›æ»šå®Œæˆï¼"
        fi
        ;;
    "rollback-soft"|"rbs")
        if [ -z "$2" ]; then
            echo "âŒ è¯·æŒ‡å®šè¦å›æ»šåˆ°çš„æäº¤ID"
            echo "ğŸ’¡ ä½¿ç”¨æ–¹æ³•: zhugit rollback-soft <æäº¤ID>"
            echo "ğŸ“‹ æŸ¥çœ‹å¯ç”¨æäº¤: zhugit log"
        else
            echo "ğŸ”„ è½¯å›æ»šåˆ°æäº¤: $2 (ä¿ç•™æ›´æ”¹)"
            git reset --soft "$2"
            echo "âœ… è½¯å›æ»šå®Œæˆï¼æ›´æ”¹å·²ä¿ç•™åœ¨æš‚å­˜åŒº"
        fi
        ;;
    "rollback-to"|"rbt")
        if [ -z "$2" ]; then
            echo "âŒ è¯·æŒ‡å®šè¦å›æ»šåˆ°çš„æäº¤ID"
            echo "ğŸ’¡ ä½¿ç”¨æ–¹æ³•: zhugit rollback-to <æäº¤ID>"
            echo "ğŸ“‹ æŸ¥çœ‹å¯ç”¨æäº¤: zhugit log"
        else
            echo "ğŸ”„ å®‰å…¨å›æ»šåˆ°æäº¤: $2 (ä¿ç•™å†å²è®°å½•)"
            echo "ğŸ“ è¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å›æ»šæäº¤ï¼Œä¿ç•™æ‰€æœ‰å†å²"
            
            # è·å–å½“å‰HEADçš„æäº¤ä¿¡æ¯
            current_commit=$(git rev-parse HEAD)
            current_message=$(git log --format=%s -1)
            
            # é‡ç½®åˆ°ç›®æ ‡æäº¤
            git reset --hard "$2"
            
            # åˆ›å»ºå›æ»šæäº¤
            git commit --allow-empty -m "ğŸ”„ å›æ»šåˆ°: $2
åŸæäº¤: $current_commit
åŸä¿¡æ¯: $current_message
æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
            
            echo "âœ… å®‰å…¨å›æ»šå®Œæˆï¼å†å²è®°å½•å·²ä¿ç•™"
            echo "ğŸ“Š æ–°çš„å›æ»šæäº¤å·²åˆ›å»º"
        fi
        ;;
    "diff")
        echo "ğŸ” æŸ¥çœ‹å·®å¼‚:"
        git diff
        ;;
    "help"|*)
        echo "ğŸš€ ZhuGit - æœ±æ°Gitæ“ä½œå·¥å…·:"
        echo "  zhugit init            - åˆå§‹åŒ–Gitä»“åº“"
        echo "  zhugit new-project [åç§°] - åˆ›å»ºæ–°é¡¹ç›®(åŒ…å«Gitåˆå§‹åŒ–)"
        echo "  zhugit connect-github [URL] - è¿æ¥åˆ°GitHubä»“åº“"
        echo "  zhugit quick-setup [åç§°] - å¿«é€Ÿè®¾ç½®é¡¹ç›®"
        echo "  zhugit add [æ–‡ä»¶]      - æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº"
        echo "  zhugit commit [ä¿¡æ¯]   - æäº¤æ›´æ”¹"
        echo "  zhugit status          - æŸ¥çœ‹çŠ¶æ€"
        echo "  zhugit log             - æŸ¥çœ‹å†å²"
        echo "  zhugit checkout [åˆ†æ”¯]  - æ£€å‡ºåˆ†æ”¯"
        echo "  zhugit update          - æ›´æ–°é¡¹ç›®"
        echo "  zhugit revert [æ–‡ä»¶]   - æ¢å¤æ–‡ä»¶"
        echo "  zhugit rollback [ID]   - ç¡¬å›æ»šåˆ°æŒ‡å®šæäº¤"
        echo "  zhugit rollback-soft [ID] - è½¯å›æ»š(ä¿ç•™æ›´æ”¹)"
        echo "  zhugit rollback-to [ID] - åˆ›å»ºå›æ»šæäº¤"
        echo "  zhugit diff            - æŸ¥çœ‹å·®å¼‚"
        echo "  zhugit help            - æ˜¾ç¤ºå¸®åŠ©"
        ;;
esac
